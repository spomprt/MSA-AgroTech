# ADR: Сводное решение — локальный (Edge‑first) vs облачный (Cloud‑first)

**Дата:** 2025‑08‑12  
**Статус:** Accepted  
**Автор:** Хафизуллин Бари

---

## Контекст
В рамках заданий 1–3 были рассмотрены два архитектурных подхода к построению платформы мониторинга ферм:

- **Локальный (Edge‑first, Core+Edge)** — обработка видео и критичных событий на ферме (милисекунды, оффлайн), с последующей синхронизацией в центр.
- **Облачный (Cloud‑first, централизованный inference)** — обработка преимущественно в центре; на ферме — тонкие агенты/шлюзы.

Данный ADR фиксирует выбор основного подхода, альтернативу и ключевые отличия/риски.

---

## Решение (Decision)
- **Основной подход:** Edge‑first (Core+Edge).  
  Обеспечивает миллисекундную реакцию, устойчивость к обрывам связи и локальные оповещения. Соответствует SLA: оповещение ≤ 5 с, оффлайн‑работа, синхронизация ≤ 10 мин.
- **Альтернатива:** Cloud‑first (централизованная обработка).  
  Подходит для не критичных к задержкам сценариев и ферм с устойчивым интернетом, снижает TCO в инфраструктуре фермы, но хуже переносит потерю связи.

---

## Сравнение подходов (выжимка)

| Критерий | Edge‑first (основной) | Cloud‑first (альтернатива) |
|---|---|---|
| Устойчивость/оффлайн | Локальная обработка и алерты; связь не критична | Зависимость от интернета; при оффлайне деградация сервисов |
| Задержки/RT | Миллисекунды на ферме; оповещение ≤ 5 с | Выше (сеть/облако); сложнее уложиться в ≤ 5 с |
| Стоимость | Дороже на ферме (GPU/edge‑ресурсы) | Дешевле на ферме; дороже трафик/облако |
| Операции | Сложнее fleet‑менеджмент агентов | Проще централизованно; меньше edge‑компонентов |
| Масштабирование | Горизонтальный скейл агентов; центр агрегирует | Центр несёт основную нагрузку; нужен мощный стриминг |
| Консистентность | Eventual между Edge↔Core (≤ 10 мин) | Централизованная истина; меньше расхождений |
| Риски | Управление версиями моделей на Edge; аппаратные отказы | Задержки сети; потеря интернет‑доступа блокирует RT |
| Безопасность | mTLS к центру; локальные секреты | Централизация секретов; больше внешнего периметра |
| Наблюдаемость | Двухдоменные трейсы/метрики | Проще единый контур наблюдаемости |

---

## Обоснование выбора основного
- Жёсткие требования по времени реакции и оффлайн‑устойчивости невозможно гарантировать в Cloud‑first при нестабильной связи.
- Edge‑first локализует риски сети, а центральный контур остаётся местом агрегации, интеграций и длительного хранения.

---

## Последствия
- Требуются процессы управления флотом агентов (обновления, здоровье, версии моделей), буферизация и дедупликация событий.
- Центр проектируется под eventual‑consistency и операторские подсказки «данные не актуальны» при оффлайне.

---

## Когда выбирать альтернативу (Cloud‑first)
- Фермы с надёжным интернетом, невысокая критичность RT‑реакции, акцент на централизованной аналитике и снижении edge‑стоимости.
- Пилоты/демо‑стенды без требований к оффлайн‑работе.

---

## Ссылки
- Подробная проработка Core+Edge: `Task2/v1/c2.puml`, `Task4/v1/adr.md`
- Вариант Cloud‑first: `Task2/v2/c2.puml`, `Task4/v2/adr.md`
- Общая контекстная архитектура: `Task1/v1/adr.md`, `Task1/v2/adr.md`


