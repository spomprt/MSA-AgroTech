@startuml
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

title Система мониторинга и видеоаналитики — C4 Контекст

LAYOUT_WITH_LEGEND()

' Акторы
Person(operator, "Оператор / ветврач", "Следит за состоянием животных, получает оповещения")
Person(oncall, "Дежурный на ферме", "Получает локальные оповещения при отсутствии интернета")
Person(admin, "Администратор", "Управляет ролями и интеграциями")

' Система
System_Boundary(sys, "Система мониторинга животных") {
    System(central, "Центральный сервер", "Хранение данных, централизованный inference, API, управление конфигурацией")
    System(agents, "Edge-шлюзы (тонкие агенты)", "Приём и форвардинг видео/телеметрии; управление подключениями; без локальной аналитики")
}

' Внешние системы
System_Ext(cameras, "IP-камеры", "RTSP/ONVIF, в т.ч. ночная съемка")
System_Ext(feeders, "Кормушки и поилки", "Разные производители")
System_Ext(water, "Система фильтрации воды", "Датчики состояния/качества")
System_Ext(idp, "Провайдер идентификации", "OIDC/SAML")
System_Ext(erp, "ERP/Склад", "Метрики и запасы корма")
System_Ext(notify, "Сервисы уведомлений", "SMS/Push/Email, локальный шлюз")
System_Ext(ml, "ML-модель партнёров", "Детекция и классификация животных")
System_Ext(apps, "Мобильное/веб-приложение", "Работает через API")

' Связи пользователей
Rel(operator, central, "Мониторинг, оповещения, настройки")
Rel(admin, central, "Управление ролями и интеграциями")
Rel(oncall, central, "Получает оповещения из центра")

' Связи внутри системы
Rel(central, agents, "Конфигурация и получение данных", "HTTPS/MQTT", "Асинхронно (≤10 мин)")
Rel(agents, central, "События и метрики", "HTTPS/MQTT", "Асинхронно (≤10 мин)")

' Интеграции
Rel(agents, cameras, "Приём и форвардинг видеопотоков")
Rel(central, feeders, "Управляет кормушками/поилками", "Через агента")
Rel(central, water, "Мониторинг телеметрии", "Через агента")
Rel(central, notify, "Оповещения (SMS/Push/Email)")
Rel(central, idp, "Аутентификация и авторизация")
Rel(central, erp, "Обмен базовыми метриками")
Rel(apps, central, "Доступ к API")
Rel(central, ml, "Использует модели для инференса")

@enduml
